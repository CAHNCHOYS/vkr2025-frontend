import{d as F,j as w,l as j,o as z,n as G,c as k,a as c,e as o,w as n,r,b as a,F as $,f as g,g as f,t as D,T as R,h as H,k as V,i as u,_ as J}from"./index-CvDodZGt.js";import{u as K}from"./tests-DpkO6g9H.js";import{_ as P}from"./Question.vue_vue_type_script_setup_true_lang-SSrbCr3n.js";import{_ as W,a as X,b as Y,c as Z}from"./CreateQuestions.vue_vue_type_script_setup_true_lang-CNOvf4Di.js";import"./testService-9nofkfVE.js";const q={class:"mb-6"},ee={class:"pl-4 text-h6 mb-3 font-weight-bold"},te=F({__name:"TeacherTestEdit",setup(se){const b=G(),e=K(),x=w(!1),y=w(!1),h=w("text"),O=async(d,t)=>{if(t===0&&d==="up"||t===e.testQuestions.length-1&&d==="down")return;let Q=e.getSortedTestQuestions[t].id,m=0;if(d==="down"){await e.updateQuestionOrder(e.getSortedTestQuestions[t].id,e.getSortedTestQuestions[t+1].orderInTest),await e.updateQuestionOrder(e.getSortedTestQuestions[t+1].id,e.getSortedTestQuestions[t].orderInTest),m=e.getSortedTestQuestions[t+1].id;const p=e.testQuestions.findIndex(l=>l.id===Q),v=e.testQuestions.findIndex(l=>l.id===m);[e.testQuestions[p].orderInTest,e.testQuestions[v].orderInTest]=[e.testQuestions[v].orderInTest,e.testQuestions[p].orderInTest]}else if(d==="up"){await e.updateQuestionOrder(e.getSortedTestQuestions[t].id,e.getSortedTestQuestions[t-1].orderInTest),await e.updateQuestionOrder(e.getSortedTestQuestions[t-1].id,e.getSortedTestQuestions[t].orderInTest),m=e.getSortedTestQuestions[t-1].id;const p=e.testQuestions.findIndex(l=>l.id===Q),v=e.testQuestions.findIndex(l=>l.id===m);[e.testQuestions[p].orderInTest,e.testQuestions[v].orderInTest]=[e.testQuestions[v].orderInTest,e.testQuestions[p].orderInTest]}},B=async d=>{await e.addNewQuestion({...d,order:e.testQuestions.length?e.getSortedTestQuestions[e.getSortedTestQuestions.length-1].orderInTest+1:1,type:h.value,testId:+b.params.id})},_=w(0),L=d=>{_.value=d,y.value=!0},i=j(()=>e.testQuestions.find(d=>d.id===_.value));return z(async()=>{await e.loadSingleTest(+b.params.id)}),(d,t)=>{const Q=r("v-toolbar-title"),m=r("v-btn"),p=r("v-toolbar"),v=r("v-text-field"),l=r("v-card-title"),T=r("v-card-text"),S=r("v-alert"),A=r("v-card"),I=r("v-dialog"),U=r("v-progress-circular"),N=r("v-snackbar");return u(),k($,null,[c("div",null,[t[11]||(t[11]=c("h2",{class:"text-h3 mb-8"},"Вопросы теста",-1)),o(A,{class:"pa-10 rounded-0",elevation:"10",border:"1"},{default:n(()=>[o(l,null,{default:n(()=>[o(p,{color:"indigo",class:"mb-5"},{default:n(()=>[o(Q,null,{default:n(()=>[f("Всего вопросов: "+D(a(e).testQuestions.length),1)]),_:1}),o(m,{onClick:t[0]||(t[0]=s=>x.value=!0),icon:"mdi-plus",color:"white"})]),_:1}),o(v,{label:"Название теста",modelValue:a(e).editingTestName,"onUpdate:modelValue":t[1]||(t[1]=s=>a(e).editingTestName=s),class:"mb-4"},null,8,["modelValue"]),c("div",q,[o(m,{color:"indigo","prepend-icon":"mdi-content-save-outline",class:"text-white",onClick:t[2]||(t[2]=()=>a(e).updateTestname(+a(b).params.id,a(e).editingTestName)),loading:a(e).isActionLoading},{default:n(()=>t[9]||(t[9]=[f("Обновить название")])),_:1},8,["loading"])])]),_:1}),a(e).testQuestions.length?(u(),g(T,{key:0},{default:n(()=>[o(R,{name:"list",tag:"ul"},{default:n(()=>[(u(!0),k($,null,H(a(e).getSortedTestQuestions,(s,E)=>{var C;return u(),k("div",{key:s.id,class:"border-thin mb-4 pa-4"},[c("h4",ee,"Вопрос № "+D(E+1),1),o(P,{text:s.text,answers:(C=s.answers)==null?void 0:C.split("|"),type:s.type,"user-answer":s.rightAnswer.includes("|")?s.rightAnswer.split("|"):s.rightAnswer,"is-editable":!0,class:"mb-6 pa-4",onMoveQuestion:M=>O(M,E),onDeleteQuestion:()=>a(e).deleteTestQuestion(s.id),onEditQuestion:()=>L(s.id)},null,8,["text","answers","type","user-answer","onMoveQuestion","onDeleteQuestion","onEditQuestion"])])}),128))]),_:1})]),_:1})):(u(),g(S,{key:1,type:"info",class:"text-h6"},{default:n(()=>t[10]||(t[10]=[f(" В тесте нет вопросов, добавьте хотя бы один или тест попросту не существует. ")])),_:1}))]),_:1})]),o(I,{modelValue:x.value,"onUpdate:modelValue":t[4]||(t[4]=s=>x.value=s),"max-width":"900",transition:"dialog-bottom-transition"},{default:n(()=>[o(A,{class:"pa-6",elevation:"6",border:"0"},{default:n(()=>[o(l,{class:"text-center text-h5 mb-4"},{default:n(()=>t[12]||(t[12]=[f("Добавление вопроса")])),_:1}),o(T,null,{default:n(()=>[o(W,{"is-loading":a(e).isActionLoading,"is-test-name-entered":!0,onUpdateQustionType:t[3]||(t[3]=s=>h.value=s),onCreateQuestion:B},null,8,["is-loading"])]),_:1})]),_:1})]),_:1},8,["modelValue"]),o(I,{modelValue:y.value,"onUpdate:modelValue":t[8]||(t[8]=s=>y.value=s),"max-width":"900",transition:"dialog-bottom-transition"},{default:n(()=>[o(A,{class:"pa-6",elevation:"6",border:"0"},{default:n(()=>[o(l,{class:"text-center text-h5 mb-4"},{default:n(()=>t[13]||(t[13]=[f("Редактирование вопроса")])),_:1}),a(e).isActionLoading?(u(),g(T,{key:1},{default:n(()=>[o(U,{color:"primary",indeterminate:"",size:50})]),_:1})):(u(),g(T,{key:0},{default:n(()=>[i.value.type==="text"?(u(),g(X,{key:0,"is-editable":!0,"edit-form-data":{text:i.value.text,answers:i.value.answers,rightAnswer:i.value.rightAnswer,weight:i.value.weight},onAddQuestion:t[5]||(t[5]=s=>a(e).updateTestQuestion(_.value,s))},null,8,["edit-form-data"])):V("",!0),i.value.type==="multiply"?(u(),g(Y,{key:1,"is-editable":!0,"edit-form-data":{text:i.value.text,answers:i.value.answers,rightAnswer:i.value.rightAnswer,weight:i.value.weight},onAddQuestion:t[6]||(t[6]=s=>a(e).updateTestQuestion(_.value,s))},null,8,["edit-form-data"])):V("",!0),i.value.type==="single"?(u(),g(Z,{key:2,"is-editable":!0,"edit-form-data":{text:i.value.text,answers:i.value.answers,rightAnswer:i.value.rightAnswer,weight:i.value.weight},onAddQuestion:t[7]||(t[7]=s=>a(e).updateTestQuestion(_.value,s))},null,8,["edit-form-data"])):V("",!0)]),_:1}))]),_:1})]),_:1},8,["modelValue"]),o(N,{"model-value":a(e).isActionError,vertical:""},{default:n(()=>[o(S,{type:"error",class:"text-h6"},{default:n(()=>t[14]||(t[14]=[f(" Ошибка при выполнении действия, вохможно, данные не сохранятся, обновите страницу!")])),_:1})]),_:1},8,["model-value"]),o(N,{"model-value":a(e).isActionSuccess,vertical:"",color:"green"},{default:n(()=>[o(S,{type:"success",class:"text-h6"},{default:n(()=>t[15]||(t[15]=[f(" Действие сохранено! ")])),_:1})]),_:1},8,["model-value"])],64)}}}),le=J(te,[["__scopeId","data-v-fc1db3da"]]);export{le as default};
